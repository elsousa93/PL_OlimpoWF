{
    "className": "org.joget.apps.form.model.Form",
    "elements": [
        {
            "className": "org.joget.apps.form.model.Section",
            "elements": [{
                "className": "org.joget.apps.form.model.Column",
                "elements": [
                    {
                        "className": "org.joget.apps.form.lib.HiddenField",
                        "properties": {
                            "id": "id_processo",
                            "permission_rules": {
                                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                                "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                                "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {},
                                "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {},
                                "504595d7-fa4b-d219-d8a6-65d1a4da0728": {},
                                "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                                "e94738b9-1966-5300-3072-703d03acb3df": {},
                                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                            },
                            "useDefaultWhenEmpty": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "encryption": "",
                            "id": "n_processo",
                            "label": "Número do Processo",
                            "maxlength": "",
                            "permission_rules": {
                                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                                "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                                "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {},
                                "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {},
                                "504595d7-fa4b-d219-d8a6-65d1a4da0728": {},
                                "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                                "e94738b9-1966-5300-3072-703d03acb3df": {},
                                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                            },
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.SelectBox",
                        "properties": {
                            "controlField": "",
                            "id": "banco_fundo",
                            "label": "Banco/Fundo",
                            "multiple": "",
                            "options": [],
                            "optionsBinder": {
                                "className": "org.joget.apps.form.lib.FormOptionsBinder",
                                "properties": {
                                    "addEmptyOption": "true",
                                    "cacheInterval": "",
                                    "emptyLabel": "",
                                    "extraCondition": "c_nome_campo = 'nome_banco' AND e.customProperties.servico LIKE '%PROCU%'",
                                    "formDefId": "adicionarOpcaoLV",
                                    "groupingColumn": "",
                                    "idColumn": "value",
                                    "labelColumn": "label",
                                    "useAjax": ""
                                }
                            },
                            "permission_rules": {
                                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                                "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                                "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {},
                                "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {},
                                "504595d7-fa4b-d219-d8a6-65d1a4da0728": {},
                                "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                                "e94738b9-1966-5300-3072-703d03acb3df": {},
                                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                            },
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "validator": {
                                "className": "org.joget.apps.form.lib.DefaultValidator",
                                "properties": {
                                    "mandatory": "true",
                                    "message": "#i18n.mandatorymsg#",
                                    "type": ""
                                }
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.DatePicker",
                        "properties": {
                            "allowManual": "",
                            "currentDateAs": "",
                            "dataFormat": "yyyy-MM-dd",
                            "datePickerType": "dateTime",
                            "endDateFieldId": "",
                            "format": "dd/mm/yy",
                            "format24hr": "true",
                            "id": "data_primeira_entrada",
                            "label": "Data de Primeira Entrada",
                            "permissionHidden": "",
                            "permission_rules": {
                                "04d94e96-37aa-1e4b-d5fe-5595f325e232": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "1fb8f1eb-7717-2af5-ccf1-03a73c560f16": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "2dd4cc96-cc40-f285-e376-ebda47490646": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "504595d7-fa4b-d219-d8a6-65d1a4da0728": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "6c9a9c6d-bd10-4f4a-0682-541bcbb1222b": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "710a05c8-c837-e0d0-670a-720473cb5a7c": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "966fc1ca-d0b8-439f-6ab3-76cf9a599c75": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "9f700b46-bde2-cc69-98a7-c562c400ad6d": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "9fb8a08a-3747-1f8e-48ac-fff77f61d611": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "aa6ccea8-6e7f-1433-8d14-32132e9bf1e0": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "d07f81ea-a80c-4560-01fd-7772c1762b0f": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "d6fe0da9-3aa3-9d28-ded2-07a6fb980292": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "e94738b9-1966-5300-3072-703d03acb3df": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "f6d47cc6-84dc-c359-9ec5-794a6dcbf118": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                }
                            },
                            "placeholder": "",
                            "readonly": "true",
                            "readonlyLabel": "",
                            "startDateFieldId": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": "",
                            "yearRange": "c-10:c"
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.DatePicker",
                        "properties": {
                            "allowManual": "true",
                            "currentDateAs": "",
                            "dataFormat": "yyyy-MM-dd",
                            "datePickerType": "dateTime",
                            "endDateFieldId": "",
                            "format": "dd/mm/yy",
                            "format24hr": "true",
                            "id": "data_entrada",
                            "label": "Data de Última Entrada",
                            "permission_rules": {
                                "04d94e96-37aa-1e4b-d5fe-5595f325e232": {},
                                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                                "1fb8f1eb-7717-2af5-ccf1-03a73c560f16": {},
                                "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                                "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {},
                                "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {},
                                "504595d7-fa4b-d219-d8a6-65d1a4da0728": {},
                                "6c9a9c6d-bd10-4f4a-0682-541bcbb1222b": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                                "966fc1ca-d0b8-439f-6ab3-76cf9a599c75": {},
                                "9f700b46-bde2-cc69-98a7-c562c400ad6d": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "9fb8a08a-3747-1f8e-48ac-fff77f61d611": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "aa6ccea8-6e7f-1433-8d14-32132e9bf1e0": {
                                    "permissionHidden": "",
                                    "readonly": ""
                                },
                                "d07f81ea-a80c-4560-01fd-7772c1762b0f": {},
                                "d6fe0da9-3aa3-9d28-ded2-07a6fb980292": {},
                                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                                "e94738b9-1966-5300-3072-703d03acb3df": {},
                                "f6d47cc6-84dc-c359-9ec5-794a6dcbf118": {},
                                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                            },
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "startDateFieldId": "",
                            "validator": {
                                "className": "org.joget.apps.form.lib.BeanShellValidator",
                                "properties": {
                                    "decoration": "*",
                                    "script": "import java.util.Arrays;\r\nimport org.joget.apps.app.service.AppUtil;\r\nimport org.joget.apps.form.model.Element;\r\nimport org.joget.apps.form.model.Form;\r\nimport org.joget.apps.form.model.FormData;\r\nimport org.joget.apps.form.service.FormUtil;\r\nimport org.joget.commons.util.LogUtil;\r\n  \r\npublic boolean validate(Element element, FormData formData, String[] fileUploadValues){\r\n    \r\n\r\n    \r\n    boolean result = true;\r\n    \r\n        //Configure field to validate - UPDATE HERE\r\n        String fieldId = \"data_entrada\";\r\n        \r\n        //Get element value\r\n        Form form = FormUtil.findRootForm(element);\r\n        Element field = FormUtil.findElement(fieldId, form, formData);\r\n        String fieldValue = FormUtil.getElementPropertyValue(field, formData);\r\n        \r\n        //If element is not filled give error message\r\n        if (fieldValue == null || fieldValue.equals(\"\")){\r\n            String id = FormUtil.getElementParameterName(element);\r\n            formData.addFormError(id, \"Campo obrigatório\");\r\n            result = false;\r\n        }else{\r\n            result = true;\r\n        }\r\n\r\n    return result;\r\n\r\n}\r\n\r\n//call validate method with injected variable\r\nreturn validate(element, formData, values);"
                                }
                            },
                            "value": "",
                            "workflowVariable": "",
                            "yearRange": "c-10:c"
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.DatePicker",
                        "properties": {
                            "allowManual": "",
                            "currentDateAs": "",
                            "dataFormat": "",
                            "datePickerType": "dateTime",
                            "endDateFieldId": "",
                            "format": "",
                            "format24hr": "true",
                            "id": "dateCreated",
                            "label": "Data de Criação",
                            "permissionHidden": "",
                            "permission_rules": {
                                "04d94e96-37aa-1e4b-d5fe-5595f325e232": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "1fb8f1eb-7717-2af5-ccf1-03a73c560f16": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "2dd4cc96-cc40-f285-e376-ebda47490646": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "504595d7-fa4b-d219-d8a6-65d1a4da0728": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "6c9a9c6d-bd10-4f4a-0682-541bcbb1222b": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "710a05c8-c837-e0d0-670a-720473cb5a7c": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "966fc1ca-d0b8-439f-6ab3-76cf9a599c75": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "9f700b46-bde2-cc69-98a7-c562c400ad6d": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "9fb8a08a-3747-1f8e-48ac-fff77f61d611": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "aa6ccea8-6e7f-1433-8d14-32132e9bf1e0": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "d07f81ea-a80c-4560-01fd-7772c1762b0f": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "d6fe0da9-3aa3-9d28-ded2-07a6fb980292": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "e94738b9-1966-5300-3072-703d03acb3df": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "f6d47cc6-84dc-c359-9ec5-794a6dcbf118": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                },
                                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {
                                    "permissionHidden": "",
                                    "readonly": "true"
                                }
                            },
                            "placeholder": "",
                            "readonly": "true",
                            "readonlyLabel": "",
                            "startDateFieldId": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": "",
                            "yearRange": "c-10:c+10"
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.DatePicker",
                        "properties": {
                            "allowManual": "",
                            "currentDateAs": "",
                            "dataFormat": "yyyy-MM-dd",
                            "datePickerType": "",
                            "endDateFieldId": "",
                            "format": "",
                            "id": "data_rececao_originais",
                            "label": "Data de Receção Originais",
                            "permission_rules": {
                                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                                "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {},
                                "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {},
                                "504595d7-fa4b-d219-d8a6-65d1a4da0728": {},
                                "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                                "e94738b9-1966-5300-3072-703d03acb3df": {},
                                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                            },
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "startDateFieldId": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": "",
                            "yearRange": "c-10:c+10"
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.DatePicker",
                        "properties": {
                            "allowManual": "",
                            "currentDateAs": "",
                            "dataFormat": "yyyy-MM-dd",
                            "datePickerType": "dateTime",
                            "endDateFieldId": "",
                            "format": "",
                            "format24hr": "true",
                            "id": "data_comunicacao_cliente",
                            "label": "Data de Comunicação ao Cliente",
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "startDateFieldId": "",
                            "validator": {
                                "className": "org.joget.apps.form.lib.BeanShellValidator",
                                "properties": {
                                    "decoration": "",
                                    "script": "import java.util.Arrays;\r\nimport org.joget.apps.app.service.AppUtil;\r\nimport org.joget.apps.form.model.Element;\r\nimport org.joget.apps.form.model.Form;\r\nimport org.joget.apps.form.model.FormData;\r\nimport org.joget.apps.form.service.FormUtil;\r\nimport org.joget.commons.util.LogUtil;\r\n  \r\npublic boolean validate(Element element, FormData formData, String[] values){\r\n    \r\n    Form form = FormUtil.findRootForm(element);\r\n    \r\n    //Get value estado\r\n    Element estadoField = FormUtil.findElement(\"estado\", form, formData);\r\n    String estado =  FormUtil.getElementPropertyValue(estadoField, formData);\r\n    \r\n    //LogUtil.info(\"Estado\", \"AAAAAAAA\" + estado);\r\n    \r\n    \r\n    \r\n    boolean result = true;\r\n    \r\n    \r\n    \r\n    if(estado.equals(\"AGD\")){\r\n       //If element is not filled give error message\r\n       //LogUtil.info(\"Values\", \"AAAAAAAA\" + values);\r\n        if (values == null || values.length == 0 || values[0].equals(\"\")){\r\n            \r\n            String id = FormUtil.getElementParameterName(element);\r\n            formData.addFormError(id, \"Campo obrigatório quando o estado é Agendado\");\r\n            result = false;\r\n        }else{\r\n            result = true;\r\n        }\r\n    }\r\n\r\n    return result;\r\n\r\n}\r\n\r\n//call validate method with injected variable\r\nreturn validate(element, formData, values);"
                                }
                            },
                            "value": "",
                            "workflowVariable": "",
                            "yearRange": "c-10:c+10"
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.SelectBox",
                        "properties": {
                            "controlField": "banco_fundo",
                            "id": "tipo_processo",
                            "label": "Tipo de processo",
                            "multiple": "",
                            "options": [],
                            "optionsBinder": {
                                "className": "org.joget.apps.form.lib.BeanShellFormBinder",
                                "properties": {
                                    "cacheInterval": "",
                                    "script": "import org.joget.apps.app.service.AppUtil;\r\nimport org.joget.apps.form.model.Element;\r\nimport org.joget.apps.form.model.FormData;\r\nimport org.joget.apps.form.model.FormRow;\r\nimport org.joget.apps.form.model.FormRowSet;\r\nimport org.joget.apps.form.model.FormStoreBinder;\r\nimport java.sql.Connection;\r\nimport java.sql.PreparedStatement;\r\nimport java.sql.ResultSet;\r\nimport java.sql.SQLException;\r\nimport javax.sql.DataSource;\r\nimport org.joget.apps.form.service.FormUtil;\r\nimport org.joget.apps.app.model.AppDefinition;\r\nimport org.joget.commons.util.LogUtil;\r\n\r\n \r\npublic FormRowSet load(String[] values) {\r\n\r\n    FormRowSet rows = new FormRowSet();\r\n    \r\n    FormRow option = new FormRow();\r\n    option.setProperty(FormUtil.PROPERTY_VALUE, \"\");\r\n    option.setProperty(FormUtil.PROPERTY_LABEL, \"\");\r\n    rows.add(option);\r\n    \r\n    String banco = null;\r\n    if (values != null && values.length > 0) {\r\n        banco = \"%\" + values[0] + \"%\";\r\n    \r\n        Connection con = null;\r\n        PreparedStatement stmt = null;\r\n        ResultSet rs = null;\r\n        String origem_value = \"\";\r\n        String origem_label = \"\";\r\n        \r\n        AppDefinition appDef = AppUtil.getCurrentAppDefinition();\r\n        \r\n        try{\r\n                DataSource ds = (DataSource)AppUtil.getApplicationContext().getBean(\"setupDataSource\");\r\n                con = ds.getConnection();\r\n                \r\n                \r\n                if(!con.isClosed()){\r\n                    \r\n                    String query=\"SELECT c_value, c_label FROM app_fd_listas_de_valores WHERE c_nome_campo = ? AND c_banco LIKE ? AND c_servico LIKE '%PROCU%';\";\r\n                    stmt = con.prepareStatement(query);\r\n                    stmt.setObject(1, \"tipo_processo\");\r\n                    stmt.setObject(2, banco);\r\n                    rs = stmt.executeQuery();\r\n                    \r\n                    while(rs.next()){\r\n                        origem_value = rs.getString(1);\r\n                        origem_label = rs.getString(2);\r\n                        \r\n                        FormRow option = new FormRow();\r\n                        option.setProperty(FormUtil.PROPERTY_VALUE, origem_value);\r\n                        option.setProperty(FormUtil.PROPERTY_LABEL, origem_label);\r\n                        \r\n                        rows.add(option);\r\n                        \r\n                    }\r\n                }\r\n                \r\n        }catch(Exception e){\r\n            LogUtil.error(\"Importa processo - origem de processo\", e, \"Error getting info from DB\");\r\n        }finally{\r\n            try{\r\n                if(rs != null){\r\n                rs.close();\r\n                }\r\n                if(stmt != null){\r\n                    stmt.close();\r\n                }\r\n                if(con != null && !con.isClosed()) {\r\n                    con.close();\r\n                }\r\n            }catch(Exception e){\r\n                LogUtil.error(\"Importa processo - origem de processo\", e, \"Error closing DB connection\");\r\n            }\r\n            \r\n        }\r\n        \r\n    }\r\n\r\n    return rows;\r\n}\r\n \r\n//call load method with injected variable\r\nreturn load(values);",
                                    "useAjax": "true"
                                }
                            },
                            "permission_rules": {
                                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                                "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                                "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {},
                                "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {},
                                "504595d7-fa4b-d219-d8a6-65d1a4da0728": {},
                                "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                                "e94738b9-1966-5300-3072-703d03acb3df": {},
                                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                            },
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.SelectBox",
                        "properties": {
                            "controlField": "banco_fundo",
                            "id": "sociedade_representada",
                            "label": "Sociedade Representada",
                            "multiple": "",
                            "options": [],
                            "optionsBinder": {
                                "className": "org.joget.apps.form.lib.BeanShellFormBinder",
                                "properties": {
                                    "cacheInterval": "",
                                    "script": "import org.joget.apps.app.service.AppUtil;\r\nimport org.joget.apps.form.model.Element;\r\nimport org.joget.apps.form.model.FormData;\r\nimport org.joget.apps.form.model.FormRow;\r\nimport org.joget.apps.form.model.FormRowSet;\r\nimport org.joget.apps.form.model.FormStoreBinder;\r\nimport java.sql.Connection;\r\nimport java.sql.PreparedStatement;\r\nimport java.sql.ResultSet;\r\nimport java.sql.SQLException;\r\nimport javax.sql.DataSource;\r\nimport org.joget.apps.form.service.FormUtil;\r\nimport org.joget.apps.app.model.AppDefinition;\r\nimport org.joget.commons.util.LogUtil;\r\n\r\n \r\npublic FormRowSet load(String[] values) {\r\n\r\n    \r\n    FormRowSet rows = new FormRowSet();\r\n    \r\n    FormRow option = new FormRow();\r\n    option.setProperty(FormUtil.PROPERTY_VALUE, \"\");\r\n    option.setProperty(FormUtil.PROPERTY_LABEL, \"\");\r\n    rows.add(option);\r\n    \r\n    String banco = null;\r\n    if (values != null && values.length > 0) {\r\n        banco = \"%\" + values[0] + \"%\";\r\n    \r\n        Connection con = null;\r\n        PreparedStatement stmt = null;\r\n        ResultSet rs = null;\r\n        String origem_value = \"\";\r\n        String origem_label = \"\";\r\n        \r\n        AppDefinition appDef = AppUtil.getCurrentAppDefinition();\r\n        \r\n        try{\r\n                DataSource ds = (DataSource)AppUtil.getApplicationContext().getBean(\"setupDataSource\");\r\n                con = ds.getConnection();\r\n                \r\n                \r\n                if(!con.isClosed()){\r\n                    String idDetalhe_processo = \"#form.processos.detalhe_processo#\";\r\n                    //Verificar o utilizador atribuido e atualizar caso esteja errado\r\n                    String query=\"SELECT c_value, c_label FROM app_fd_listas_de_valores WHERE c_nome_campo = ? AND c_banco LIKE ? AND c_servico LIKE '%PROCU%';\";\r\n                    stmt = con.prepareStatement(query);\r\n                    stmt.setObject(1, \"sociedade_representada\");\r\n                    stmt.setObject(2, banco);\r\n                    rs = stmt.executeQuery();\r\n                    \r\n                    while(rs.next()){\r\n                        origem_value = rs.getString(1);\r\n                        origem_label = rs.getString(2);\r\n                        \r\n                        FormRow option = new FormRow();\r\n                        option.setProperty(FormUtil.PROPERTY_VALUE, origem_value);\r\n                        option.setProperty(FormUtil.PROPERTY_LABEL, origem_label);\r\n                        \r\n                        rows.add(option);\r\n                        \r\n                    }\r\n                }\r\n                \r\n        }catch(Exception e){\r\n            LogUtil.error(\"Importa processo - origem de processo\", e, \"Error getting info from DB\");\r\n        }finally{\r\n            try{\r\n                if(rs != null){\r\n                rs.close();\r\n                }\r\n                if(stmt != null){\r\n                    stmt.close();\r\n                }\r\n                if(con != null && !con.isClosed()) {\r\n                    con.close();\r\n                }\r\n            }catch(Exception e){\r\n                LogUtil.error(\"Importa processo - origem de processo\", e, \"Error closing DB connection\");\r\n            }\r\n            \r\n        }\r\n        \r\n    }\r\n\r\n    return rows;\r\n}\r\n \r\n//call load method with injected variable\r\nreturn load(values);",
                                    "useAjax": "true"
                                }
                            },
                            "permission_rules": {
                                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                                "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                                "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {},
                                "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {},
                                "504595d7-fa4b-d219-d8a6-65d1a4da0728": {},
                                "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                                "e94738b9-1966-5300-3072-703d03acb3df": {},
                                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                            },
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.SelectBox",
                        "properties": {
                            "controlField": "",
                            "id": "localizacao_imovel",
                            "label": "Localização do Imóvel",
                            "multiple": "",
                            "options": [],
                            "optionsBinder": {
                                "className": "org.joget.apps.form.lib.FormOptionsBinder",
                                "properties": {
                                    "addEmptyOption": "true",
                                    "cacheInterval": "",
                                    "emptyLabel": "",
                                    "extraCondition": "c_nome_campo = 'local_imovel' AND e.customProperties.servico LIKE '%PROCU%'",
                                    "formDefId": "adicionarOpcaoLV",
                                    "groupingColumn": "",
                                    "idColumn": "value",
                                    "labelColumn": "label",
                                    "useAjax": ""
                                }
                            },
                            "permissionHidden": "true",
                            "permission_rules": {
                                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                                "2dd4cc96-cc40-f285-e376-ebda47490646": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "504595d7-fa4b-d219-d8a6-65d1a4da0728": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "710a05c8-c837-e0d0-670a-720473cb5a7c": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "e94738b9-1966-5300-3072-703d03acb3df": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                }
                            },
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.SelectBox",
                        "properties": {
                            "controlField": "",
                            "id": "estado",
                            "label": "Estado",
                            "multiple": "",
                            "options": [],
                            "optionsBinder": {
                                "className": "org.joget.apps.form.lib.FormOptionsBinder",
                                "properties": {
                                    "addEmptyOption": "true",
                                    "cacheInterval": "",
                                    "emptyLabel": "",
                                    "extraCondition": "c_nome_campo = 'estado_processo' AND e.customProperties.servico LIKE '%PROCU%'",
                                    "formDefId": "adicionarOpcaoLV",
                                    "groupingColumn": "",
                                    "idColumn": "value",
                                    "labelColumn": "label",
                                    "useAjax": ""
                                }
                            },
                            "permission_rules": {
                                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                                "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                                "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {},
                                "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {},
                                "504595d7-fa4b-d219-d8a6-65d1a4da0728": {},
                                "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                                "e94738b9-1966-5300-3072-703d03acb3df": {},
                                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                            },
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.Radio",
                        "properties": {
                            "controlField": "",
                            "id": "originais",
                            "label": "Tem Originais?",
                            "options": [
                                {
                                    "grouping": "",
                                    "label": "Sim",
                                    "value": "SIM"
                                },
                                {
                                    "grouping": "",
                                    "label": "Nao",
                                    "value": "NAO"
                                }
                            ],
                            "optionsBinder": {
                                "className": "",
                                "properties": {}
                            },
                            "permission_rules": {
                                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                                "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                                "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {},
                                "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {},
                                "504595d7-fa4b-d219-d8a6-65d1a4da0728": {},
                                "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                                "e94738b9-1966-5300-3072-703d03acb3df": {},
                                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                            },
                            "readonly": "",
                            "readonlyLabel": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.DatePicker",
                        "properties": {
                            "allowManual": "",
                            "currentDateAs": "",
                            "dataFormat": "yyyy-MM-dd",
                            "datePickerType": "",
                            "endDateFieldId": "",
                            "format": "",
                            "id": "data_envio_originais",
                            "label": "Data de Envio de Originais para Procurador",
                            "permission_rules": {
                                "002b1a8a-e876-ce11-bc14-95ea87c94ef1": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "4feb3689-52c4-ee93-e117-d4701ab80012": {},
                                "5b8a6b01-350d-f3d7-ec53-330d613b3551": {},
                                "82da97c1-87da-f690-974b-7933ba332d50": {},
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                                "8acb7ec8-5146-02d5-bc86-1da3ddfde73b": {},
                                "d067e984-f6d4-139d-8192-5a3c2256c54c": {},
                                "d6989d7e-2d08-bb5e-bcc5-33cf1b674e5b": {}
                            },
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "startDateFieldId": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": "",
                            "yearRange": "c-10:c+10"
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "encryption": "",
                            "id": "local_envio_originais",
                            "label": "Local de Envio dos Originais",
                            "maxlength": "",
                            "permission_rules": {
                                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                                "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                                "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {},
                                "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {},
                                "504595d7-fa4b-d219-d8a6-65d1a4da0728": {},
                                "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                                "e94738b9-1966-5300-3072-703d03acb3df": {},
                                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                            },
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "encryption": "",
                            "id": "registoCTT",
                            "label": "Registo CTT",
                            "maxlength": "",
                            "permission_rules": {
                                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                                "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {
                                    "permissionHidden": "true",
                                    "readonly": ""
                                },
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                                "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {},
                                "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {},
                                "504595d7-fa4b-d219-d8a6-65d1a4da0728": {},
                                "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                                "e94738b9-1966-5300-3072-703d03acb3df": {},
                                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                            },
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "encryption": "",
                            "id": "deposito",
                            "label": "Depósito",
                            "maxlength": "",
                            "permission_rules": {
                                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                                "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                                "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {},
                                "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {},
                                "504595d7-fa4b-d219-d8a6-65d1a4da0728": {},
                                "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                                "e94738b9-1966-5300-3072-703d03acb3df": {},
                                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                            },
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.CustomHTML",
                        "properties": {
                            "autoPopulate": "",
                            "id": "field24",
                            "label": "",
                            "permission_rules": {
                                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                                "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                                "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                            },
                            "value": "<script>\n    $(document).ready(function(){\n        atualizarVisibilidadeBCP();\n        \n        $(\"select[id*=banco_fundo]\").change(function(){\n            atualizarVisibilidadeBCP();\n        });\n        \n        $(\"select[id*=tipo_processo]\").change(function(){\n            atualizarVisibilidadeBCP();\n        });\n            \n    });\n    \n    \n    function atualizarVisibilidadeBCP(){\n        var tipoProcesso = $(\"select[id*=tipo_processo]\").val();\n        var banco_fundo = $(\"select[id*=banco_fundo]\").val();\n        if(banco_fundo==='BCP'){\n            if (tipoProcesso === 'DIST' || tipoProcesso === 'MUT' || tipoProcesso === 'LEAS'){\n                $(\"select[id*=sociedade_representada]\").parent().hide();\n                $(\"input[id*=codigo_certidao_predial]\").parent().hide();\n                $(\"input[id*=validade_certidao]\").parent().hide();\n            }else{\n                $(\"select[id*=sociedade_representada]\").parent().show();\n                $(\"input[id*=codigo_certidao_predial]\").parent().show();\n                $(\"input[id*=validade_certidao]\").parent().show();\n            }\n            \n            if(tipoProcesso === 'MUT' || tipoProcesso === 'LEAS' || tipoProcesso === 'ISV' || tipoProcesso === 'CVJ'){\n                $(\"div[id*=originais]\").parent().hide();\n            }else{\n                $(\"div[id*=originais]\").parent().show();\n            }\n            \n            if(tipoProcesso === 'LEAS' || tipoProcesso === 'ISV' || tipoProcesso === 'CVJ'){\n                $(\"input[id*=local_envio_originais]\").parent().hide();\n            }else{\n                $(\"input[id*=local_envio_originais]\").parent().show();\n            }\n            \n            if(tipoProcesso === 'MUT' || tipoProcesso === 'LEAS' || tipoProcesso === 'ISV' || tipoProcesso === 'CVJ'){\n                $(\"input[id*=deposito]\").parent().hide();\n            }else{\n                $(\"input[id*=deposito]\").parent().show();\n            }\n            \n            if(tipoProcesso === 'MUT' || tipoProcesso === 'ISV' || tipoProcesso === 'CVJ'){\n                $(\"input[id*=conta]\").parent().hide();\n            }else{\n                $(\"input[id*=conta]\").parent().show();\n            }\n            \n            if(tipoProcesso === 'ISV' || tipoProcesso === 'CVJ'){\n               $(\"input[id*=centro_custo_balcao]\").parent().hide();\n            }else{\n                $(\"input[id*=centro_custo_balcao]\").parent().show();\n            }\n            \n        }\n    }\n    \n    \n<\/script>"
                        }
                    }
                ],
                "properties": {"width": "100%"}
            }],
            "properties": {
                "comment": "",
                "id": "section1_1",
                "join": "",
                "label": "Informação Geral",
                "loadBinder": {
                    "className": "",
                    "properties": {}
                },
                "permission": {
                    "className": "",
                    "properties": {}
                },
                "permissionReadonly": "",
                "permission_rules": {
                    "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                    "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                    "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                    "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                    "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                    "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {},
                    "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {},
                    "504595d7-fa4b-d219-d8a6-65d1a4da0728": {},
                    "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                    "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                    "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                    "e94738b9-1966-5300-3072-703d03acb3df": {},
                    "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                },
                "readonly": "",
                "readonlyLabel": "",
                "regex": "",
                "reverse": "",
                "storeBinder": {
                    "className": "",
                    "properties": {}
                },
                "visibilityControl": "",
                "visibilityValue": ""
            }
        },
        {
            "className": "org.joget.apps.form.model.Section",
            "elements": [{
                "className": "org.joget.apps.form.model.Column",
                "elements": [
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "encryption": "",
                            "id": "conta",
                            "label": "Conta",
                            "maxlength": "",
                            "permission_rules": {
                                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                                "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                                "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                            },
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "encryption": "",
                            "id": "valor_liquidacao_receber",
                            "label": "Valor de Liquidação / a receber",
                            "maxlength": "",
                            "permission_rules": {
                                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                                "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                                "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                            },
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "encryption": "",
                            "id": "centro_custo_balcao",
                            "label": "Centro de Custo Balcão",
                            "maxlength": "",
                            "permission_rules": {
                                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                                "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                                "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                            },
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "encryption": "",
                            "id": "codigo_certidao_predial",
                            "label": "Código de Certidão Perdial",
                            "maxlength": "",
                            "permission_rules": {
                                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                                "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                                "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                            },
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.DatePicker",
                        "properties": {
                            "allowManual": "",
                            "currentDateAs": "",
                            "dataFormat": "yyyy-MM-dd",
                            "datePickerType": "",
                            "endDateFieldId": "",
                            "format": "",
                            "id": "validade_certidao",
                            "label": "Validade da Certidão",
                            "permission_rules": {
                                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                                "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                                "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                            },
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "startDateFieldId": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": "",
                            "yearRange": "c-10:c+10"
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.CustomHTML",
                        "properties": {
                            "autoPopulate": "",
                            "id": "field20",
                            "label": "",
                            "permission_rules": {
                                "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                                "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                                "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                                "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                                "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                                "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                                "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                                "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                                "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                            },
                            "value": "<script type=\"text/javascript\">\r\n\r\n    $(document).ready(function(){\r\n\r\n        var f1 = FormUtil.getField(\"valor_liquidacao_receber\");\r\n        var number = FormUtil.getValue(\"valor_liquidacao_receber\");\r\n        \r\n        if(number != null && number !== \"\"){\r\n            number = number.replaceAll('NaN', \"0\");\r\n            number = number.replaceAll('.', \"\");\r\n            number = number.replaceAll('\u20ac', \"\");\r\n            number = number.replaceAll('Eur', \"\");\r\n            number = number.replaceAll('EUR', \"\");\r\n            number = number.replaceAll(',', '.');\r\n            \r\n            let num = new Intl.NumberFormat('pt-PT', { style: 'currency', currency: 'EUR' }).format(number);\r\n        \r\n            num = num.replace(/\\s/g, '.');\r\n            num = num.replaceAll('.\u20ac', ' EUR');\r\n            \r\n            $(f1).val(num);\r\n        }else{\r\n            //do nothing\r\n        }\r\n    });\r\n<\/script> "
                        }
                    }
                ],
                "properties": {"width": "100%"}
            }],
            "properties": {
                "comment": "",
                "id": "section2",
                "join": "",
                "label": "(Nome secção)",
                "loadBinder": {
                    "className": "",
                    "properties": {}
                },
                "permission": {
                    "className": "",
                    "properties": {}
                },
                "permissionReadonly": "",
                "permission_rules": {
                    "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                    "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                    "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                    "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                    "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                    "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                    "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                    "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                    "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                },
                "readonly": "",
                "readonlyLabel": "",
                "regex": "",
                "reverse": "",
                "storeBinder": {
                    "className": "",
                    "properties": {}
                },
                "visibilityControl": "",
                "visibilityValue": ""
            }
        },
        {
            "className": "org.joget.apps.form.model.Section",
            "elements": [{
                "className": "org.joget.apps.form.model.Column",
                "elements": [{
                    "className": "org.joget.apps.form.lib.TextArea",
                    "properties": {
                        "cols": "20",
                        "id": "observacoes",
                        "label": "Observações",
                        "permission_rules": {
                            "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                            "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                            "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                            "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                            "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                            "467e0936-e8fb-e23b-f48d-e5c28c5ab7ed": {},
                            "47d9dac4-bb53-53f7-2c45-a2b2e20e7f54": {},
                            "504595d7-fa4b-d219-d8a6-65d1a4da0728": {},
                            "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                            "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                            "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                            "e94738b9-1966-5300-3072-703d03acb3df": {},
                            "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                        },
                        "placeholder": "",
                        "readonly": "",
                        "readonlyLabel": "",
                        "rows": "5",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                }],
                "properties": {"width": "100%"}
            }],
            "properties": {
                "comment": "",
                "id": "section3",
                "join": "",
                "label": "Observações",
                "loadBinder": {
                    "className": "",
                    "properties": {}
                },
                "permission": {
                    "className": "",
                    "properties": {}
                },
                "permissionReadonly": "",
                "permission_rules": {
                    "0c699003-580e-7faf-a39c-f2e5303bd5b5": {},
                    "1804038d-e85d-3ea4-4ef3-4c4143e5145b": {},
                    "2dd4cc96-cc40-f285-e376-ebda47490646": {},
                    "40b85e69-a77b-cdfa-05ef-6bd9811e4410": {},
                    "44639061-b6ba-a2ef-a47c-c5bab888544c": {},
                    "710a05c8-c837-e0d0-670a-720473cb5a7c": {},
                    "87e7b01c-e92b-e732-c50f-c2c7020e5482": {},
                    "dccd1818-864d-54e3-09c2-6e246cfcf5fe": {},
                    "f8c01627-bf37-05aa-5732-90fe1b2327b3": {}
                },
                "readonly": "",
                "readonlyLabel": "",
                "regex": "",
                "reverse": "",
                "storeBinder": {
                    "className": "",
                    "properties": {}
                },
                "visibilityControl": "",
                "visibilityValue": ""
            }
        }
    ],
    "properties": {
        "description": "",
        "id": "detalheProcessoProcuradoria",
        "loadBinder": {
            "className": "org.joget.apps.form.lib.WorkflowFormBinder",
            "properties": {}
        },
        "name": "Procuradoria - Detalhe Processo",
        "noPermissionMessage": "",
        "permission": {
            "className": "",
            "properties": {}
        },
        "permission_rules": [
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"MTG\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "87e7b01c-e92b-e732-c50f-c2c7020e5482",
                "permission_name": "MTG"
            },
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"BIC\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "2dd4cc96-cc40-f285-e376-ebda47490646",
                "permission_name": "BIC"
            },
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"BNI\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "0c699003-580e-7faf-a39c-f2e5303bd5b5",
                "permission_name": "BNI"
            },
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"BCP\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "44639061-b6ba-a2ef-a47c-c5bab888544c",
                "permission_name": "BCP"
            },
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"HPG\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "f8c01627-bf37-05aa-5732-90fe1b2327b3",
                "permission_name": "Hipoges (HPG)"
            },
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"NOR\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "710a05c8-c837-e0d0-670a-720473cb5a7c",
                "permission_name": "Norfin (NOR)"
            },
            {
                "permission": {
                    "className": "org.joget.apps.userview.lib.BeanShellPermission",
                    "properties": {"script": "import org.joget.commons.util.LogUtil;\n\n\nString banco_fundo = \"#form.detalhe_proce_procu.banco_fundo[{form.processos_procu.detalhe_processo}]#\";\nif(banco_fundo.equals(\"WHS\")){\n    return true;\n}else{\n    return false;\n}\n"}
                },
                "permission_key": "1804038d-e85d-3ea4-4ef3-4c4143e5145b",
                "permission_name": "Whitestar (WHS)"
            }
        ],
        "postProcessor": {
            "className": "",
            "properties": {}
        },
        "postProcessorRunOn": "create",
        "storeBinder": {
            "className": "org.joget.apps.form.lib.BeanShellFormBinder",
            "properties": {
                "autoHandleFiles": "",
                "autoHandleWorkflowVariable": "true",
                "cacheInterval": "",
                "script": "import org.joget.apps.app.service.AppUtil;\r\nimport org.joget.apps.form.model.Element;\r\nimport org.joget.apps.form.model.FormData;\r\nimport org.joget.apps.form.model.FormRow;\r\nimport org.joget.apps.form.model.FormRowSet;\r\nimport org.joget.apps.form.model.FormStoreBinder;\r\nimport org.joget.plugin.base.PluginManager;\r\nimport org.joget.commons.util.LogUtil;\r\n\r\nimport java.sql.Connection;\r\nimport java.sql.PreparedStatement;\r\nimport java.sql.ResultSet;\r\nimport java.sql.SQLException;\r\nimport javax.sql.DataSource;\r\nimport org.joget.apps.form.service.FormUtil;\r\nimport org.joget.apps.app.model.AppDefinition;\r\n\r\nimport java.time.LocalDateTime; \r\nimport java.time.format.DateTimeFormatter;\r\nimport java.time.DayOfWeek;\r\nimport java.time.temporal.ChronoUnit;\r\n\r\n\r\n\r\npublic String calculateDataFim(String dateInit, String dateEnd){ //Falta receber configuração do SLA e holidays\r\n    DateTimeFormatter formatter = DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm\");\r\n    DateTimeFormatter dateFormatter = DateTimeFormatter.ofPattern(\"yyyy-MM-dd\");\r\n    LocalDateTime dateInicio = LocalDateTime.parse(dataInicio, formatter);\r\n    LocalDateTime endDateTime = null;\r\n    String endDate = \"\";\r\n     \r\n    var hour = dateInit.getHour();\r\n    int slaNumber = 1;//Integer.parseInt(sla); Hardcoded falta implementar configurações de SLA para Procuradoria\r\n    if(hour < 12){\r\n            endDateTime = dateInit.withHour(23).withMinute(59);   /**   HORAS UTEIS???   **/\r\n            \r\n            //Incrementar dias consoante o SLA\r\n            while(slaNumber > 1){\r\n                endDateTime = endDateTime.plusDays(1);\r\n                //Passar dias não uteis\r\n                while(isWeekend(endDateTime) || holidays.contains(endDateTime.format(dateFormatter))){\r\n                   endDateTime = endDateTime.plusDays(1);\r\n                }   \r\n                slaNumber -= 1;\r\n            }\r\n    \r\n        }else{\r\n            endDateTime = dateInit.plusDays(1).withHour(12).withMinute(0);\r\n            \r\n            //Incrementar dias consoante o SLA\r\n            while(slaNumber > 1){\r\n                endDateTime = endDateTime.plusDays(1);\r\n                //Passar dias não uteis\r\n                while(isWeekend(endDateTime) || holidays.contains(endDateTime.format(dateFormatter))){\r\n                   endDateTime = endDateTime.plusDays(1);\r\n                }\r\n                slaNumber -= 1;\r\n            }\r\n            \r\n            \r\n        }\r\n        \r\n        endDate = endDateTime.format(formatter);\r\n    \r\n    \r\n        return endDate;\r\n}\r\n\r\npublic String calculateSLADuration(String dataInit, String dateEnd){\r\n    DateTimeFormatter formatter = DateTimeFormatter.ofPattern(\"dd/MM/yyyy HH:mm\");\r\n    String result=\"\";\r\n    //if Data Init date format is not \"dd/MM/yyyy HH:mm\"\r\n    LogUtil.info(\"DATE INIT\", \"AAA\" + dataInit);\r\n    if(dataInit.charAt(2) != '/'){\r\n        //if Data Init date format is of the format \"yyyy-MM-dd HH:mm\"\r\n        if(dataInit.charAt(4) == '-' && dataInit.charAt(10) == ' ' && dataInit.charAt(13) == ':'){\r\n            dataInit =  dataInit.substring(8,10) + \"/\" + dataInit.substring(5,7) + \"/\" + dataInit.substring(0,4) + \" \" + dataInit.substring(11,16);\r\n        }\r\n    }\r\n    \r\n    if(dateEnd.charAt(2) != '/'){\r\n         //if Data Init date format is of the format \"yyyy-MM-dd HH:mm\"\r\n        if(dateEnd.charAt(4) == '-' && dateEnd.charAt(10) == ' ' && dateEnd.charAt(13) == ':'){\r\n            dateEnd =  dateEnd.substring(8,10) + \"/\" + dateEnd.substring(5,7) + \"/\" + dateEnd.substring(0,4) + \" \" + dateEnd.substring(11,16);\r\n        }\r\n    }\r\n\r\n    LocalDateTime dateInit = LocalDateTime.parse(dataInit, formatter);\r\n    LocalDateTime dateFinish = LocalDateTime.parse(dateEnd,formatter);\r\n    \r\n    long days = ChronoUnit.DAYS.between(dateInit, dateFinish);\r\n    int initHours = dateInit.getHour();\r\n    int finishHours = dateFinish.getHour();\r\n    \r\n    \r\n    if(initHours > 12 && finishHours < 12){\r\n        days= days - 1;    \r\n    }else if(days>0 && initHours < 12 && finishHours >= 12){\r\n        days = days + 1;\r\n    }\r\n    \r\n    \r\n    long workDays = days;\r\n    \r\n    while(days>0){\r\n        String day = dateInit.getDayOfWeek().toString();\r\n        \r\n        switch(day) {\r\n            case \"SATURDAY\":{\r\n                workDays-=1;\r\n                break;\r\n            }\r\n            case \"SUNDAY\":{\r\n                workDays-=1;\r\n                break;\r\n            }\r\n        }\r\n        dateInit = dateInit.plusDays(1);\r\n  \r\n        days-=1;\r\n    }\r\n    \r\n    result = \"D\";\r\n    if(workDays>0){\r\n        result =result + \"+\" + workDays;\r\n    }\r\n    \r\n    \r\n    \r\n    return result;\r\n}\r\n\r\n\r\npublic FormRowSet store(Element element, FormRowSet rows, FormData formData) {\r\n       //check the rows is not empty before store it\r\n       FormRow row = null;\r\n    if (rows != null && !rows.isEmpty()) {\r\n        //Get the submitted data\r\n        row = rows.get(0);\r\n        \r\n\r\n        String ProcessID = \"#process.processId#\";\r\n        String mainProcessId = rows.get(0).get(\"id_processo\");\r\n        String EstadoContratacao = rows.get(0).get(\"estado\");\r\n        String dataUltimaEntrada = rows.get(0).get(\"data_entrada\");\r\n        String dataComunicacaoCliente = rows.get(0).get(\"data_comunicacao_cliente\");\r\n        \r\n        var SLAIsOpen = false;\r\n        \r\n        Connection con = null;\r\n        PreparedStatement stmt = null;\r\n        ResultSet rs = null;\r\n    \r\n        try{\r\n            \r\n            DataSource ds = (DataSource)AppUtil.getApplicationContext().getBean(\"setupDataSource\");\r\n            con = ds.getConnection();\r\n            \r\n            if(!con.isClosed()){\r\n\r\n                if(ProcessID.startsWith(\"#process.processId\")){\r\n                                                 \r\n                    String queryGetProcessId = \"SELECT Id FROM shkprocesses WHERE ActivityRequesterProcessId = ? order by created desc ;\";\r\n                    stmt = con.prepareStatement(queryGetProcessId);\r\n                    stmt.setObject(1, mainProcessId);\r\n                    rs = stmt.executeQuery();\r\n                    if(rs.next()){\r\n                        ProcessID = rs.getObject(\"Id\");\r\n                    }\r\n                                                                                             \r\n                }\r\n                \r\n                \r\n                //Verificar se existe algum SLA do processo em aberto\r\n                String queryGetOpenSLA = \"SELECT id FROM app_fd_sla_atividade WHERE c_id_processo=? AND c_estado_atividade = 'Em curso';\";\r\n                stmt = con.prepareStatement(queryGetOpenSLA);\r\n                stmt.setObject(1, ProcessID);\r\n                rs = stmt.executeQuery();\r\n                \r\n                if(rs.next()){\r\n                    SLAIsOpen = true;\r\n                }\r\n                    \r\n                //Se o estado do processo estiver Pendente\r\n                if(EstadoContratacao.equals(\"PND\")){\r\n                    //Se o SLA estiver 'Em curso'\r\n                   \r\n                    if(SLAIsOpen){\r\n                        \r\n                        if(!dataComunicacaoCliente.isEmpty()){\r\n                            //Obter data Inicial do SLA\r\n                            String queryGetDateInitSla = \"SELECT c_data_inicio FROM app_fd_sla_atividade WHERE c_id_processo=? AND c_estado_atividade = 'Em curso';\";\r\n                            stmt = con.prepareStatement(queryGetDateInitSla);\r\n                            stmt.setObject(1, ProcessID);\r\n                            rs = stmt.executeQuery();\r\n                            String dataInit =\"\";\r\n                            if(rs.next()){\r\n                                dataInit = rs.getObject(\"c_data_inicio\").toString();\r\n                            }\r\n                            rs=null;\r\n                            LogUtil.info(\"AAAa\", \"Ir buscar data de Inicio\");\r\n                            String slaDuration = calculateSLADuration(dataInit,dataComunicacaoCliente);\r\n            \r\n                            //Atualizar o sla Em curso para fechado\r\n                            String queryReset= \"UPDATE app_fd_sla_atividade SET c_estado_atividade = 'Fechada', c_data_conclusao=? , c_duracao = ? WHERE c_id_processo=? AND c_estado_atividade = 'Em curso';\"; \r\n                            stmt = con.prepareStatement(queryReset);\r\n                            stmt.setObject(1,dataComunicacaoCliente);\r\n                            stmt.setObject(2, slaDuration);\r\n                            stmt.setObject(3, ProcessID);\r\n                            rs = stmt.executeQuery();\r\n                            rs=null;\r\n                            LogUtil.info(\"AAAa\", \"Atualizar SLA\");\r\n                        }\r\n  \r\n                    }\r\n                    \r\n                    row.setProperty(\"data_entrada\", \"\");\r\n                    row.setProperty(\"data_comunicacao_cliente\", \"\");\r\n                    \r\n                }else if(EstadoContratacao.equals(\"NOV\")){\r\n                    \r\n                    //Caso não haja nenhum SLA ativo\r\n                    if(!SLAIsOpen){\r\n                        //Se \"Data de Ultima Entrada\" e \"Data de Comunicação com o Cliente\" não tiverem vazias o SLA é iniciado  \r\n                        if(!dataUltimaEntrada.isEmpty() && !dataComunicacaoCliente.isEmpty()){\r\n                            //Obter detalhes da tarefa\r\n                            String queryGetAssignment = \"SELECT name FROM shkprocesses WHERE id=?;\";\r\n                            String queryGetUserAssign = \"SELECT resourceid FROM shkassignmentstable WHERE activityprocessid =?\";\r\n                            String nomeAtividade = \"\";\r\n                            String utilizador = \"\";\r\n                            stmt = con.prepareStatement(queryGetAssignment);\r\n                            stmt.setObject(1, ProcessID);\r\n                            rs = stmt.executeQuery();\r\n                            \r\n                            if(rs.next()){\r\n                                nomeAtividade= rs.getObject(\"name\").toString();\r\n                            }\r\n                            \r\n                            stmt = con.prepareStatement(queryGetUserAssign);\r\n                            stmt.setObject(1, ProcessID);\r\n                            rs = stmt.executeQuery();\r\n                            \r\n                            if(rs.next()){\r\n                                utilizador= rs.getObject(\"resourceid\").toString();\r\n                            }\r\n                            \r\n                            \r\n                            //Iniciar novo SLA em curso\r\n                            String queryCreateSLA = \"INSERT INTO app_fd_sla_atividade (id, dateCreated, dateModified, createdBy,createdByName ,modifiedBy, modifiedByName, c_data_inicio, c_data_fim, c_nome_atividade, c_id_processo, c_utilizador_atribuido, c_estado_atividade, c_duracao) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?);\";\r\n                            stmt = con.prepareStatement(queryCreateSLA);\r\n                            var idSLA = UuidGenerator.getInstance().getUuid();\r\n                            var dateNow =\"#date.yyyy-MM-dd HH:mm#\";\r\n                            var currentUsername = \"#currentUser.username#\";\r\n                            var currentNameUser = \"#currentUser.firstName#\" + \"#currentUser.lastName#\";\r\n                            String dataInicio = dataUltimaEntrada;\r\n                            String dataFim = calculateDataFim(dataInicio, dataComunicacaoCliente);\r\n                            String estadoAtividade = \"Em curso\";\r\n                            String duracao = \"D\";\r\n                            \r\n                            stmt.setObject(1, idSLA);\r\n                            stmt.setObject(2, dateNow);\r\n                            stmt.setObject(3, dateNow);\r\n                            stmt.setObject(4, currentUsername);\r\n                            stmt.setObject(5, currentNameUser);\r\n                            stmt.setObject(6, currentUsername);\r\n                            stmt.setObject(7, currentNameUser);\r\n                            stmt.setObject(8, dataInicio);\r\n                            stmt.setObject(9, dataFim);   \r\n                            stmt.setObject(10, nomeAtividade);\r\n                            stmt.setObject(11, ProcessID);\r\n                            stmt.setObject(12, utilizador);\r\n                            stmt.setObject(13, estadoAtividade);\r\n                            stmt.setObject(14, duracao);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            \r\n        }catch(Exception e){\r\n            LogUtil.error(\"Olimpo- Store Binder Detalhe Processo Procuradoria\", e, \"Error getting info from DB\");\r\n        \r\n        }finally{\r\n            try{\r\n                if(rs != null){\r\n                rs.close();\r\n                }\r\n                if(stmt != null){\r\n                    stmt.close();\r\n                }\r\n                if(con != null && !con.isClosed()) {\r\n                    con.close();\r\n                }\r\n            }catch(Exception e){\r\n                LogUtil.error(\"Olimpo- Store Binder Detalhe Processo\", e, \"Error closing DB connection\");\r\n            }\r\n            \r\n        }\r\n        \r\n\r\n    \r\n     //Reuse Workflow Form Binder to store data\r\n        PluginManager pluginManager = (PluginManager) AppUtil.getApplicationContext().getBean(\"pluginManager\");\r\n        FormStoreBinder binder = (FormStoreBinder) pluginManager.getPlugin(\"org.joget.apps.form.lib.WorkflowFormBinder\");\r\n        binder.store(element, rows, formData);\r\n    } \r\n    \r\n    return rows;\r\n}\r\n\r\nreturn store(element, rows, formData);",
                "useAjax": ""
            }
        },
        "tableName": "detalhe_proce_procu"
    }
}